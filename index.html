<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Entertainment Index</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Söhne', 'Helvetica Neue', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #1c1a19;
            background-image:
                url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.025'/%3E%3C/svg%3E");
            min-height: 100vh;
            color: #ede9e3;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px;
        }

        /* Content positioning - left-aligned, 55-60% width */
        .content-wrapper {
            max-width: 60%;
        }

        /* Header - GEI Masthead */
        header {
            margin-bottom: 64px;
        }

        .masthead {
            font-size: 200px;
            font-weight: 300;
            color: #6b6560;
            line-height: 0.9;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .header-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .site-title {
            font-size: 13px;
            color: #ede9e3;
            font-weight: 400;
        }

        .week-info {
            font-size: 13px;
            color: #9a958e;
            font-weight: 400;
        }

        /* Navigation - subtle footer link */
        .main-nav {
            position: fixed;
            bottom: 80px;
            left: 80px;
        }

        .nav-link {
            font-size: 11px;
            color: #6b6560;
            text-decoration: underline;
            font-weight: 400;
            transition: color 150ms ease;
        }

        .nav-link:hover {
            color: #9a958e;
        }

        /* About Page */
        .about-content {
            max-width: 60%;
        }

        .about-section {
            margin-bottom: 32px;
        }

        .about-section h3 {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
            color: #ede9e3;
        }

        .about-section p {
            font-size: 13px;
            line-height: 1.6;
            color: #9a958e;
            margin-bottom: 12px;
        }

        .about-section ul,
        .about-section ol {
            margin-left: 24px;
            margin-bottom: 12px;
        }

        .about-section li {
            font-size: 13px;
            line-height: 1.6;
            color: #9a958e;
            margin-bottom: 8px;
        }

        /* Selection Interface - Minimal */
        .selection-interface {
            margin-bottom: 48px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .sport-selector {
            font-size: 13px;
            letter-spacing: 0.05em;
        }

        .sport-option {
            color: #6b6560;
            text-decoration: none;
            cursor: pointer;
            transition: color 150ms ease;
            margin-right: 12px;
        }

        .sport-option:hover {
            color: #9a958e;
        }

        .sport-option.active {
            color: #ede9e3;
        }

        .separator {
            color: #6b6560;
            margin: 0 8px;
        }

        .season-week-selector {
            font-size: 13px;
            color: #9a958e;
        }

        .week-nav-link {
            color: #9a958e;
            text-decoration: none;
            cursor: pointer;
            transition: color 150ms ease;
        }

        .week-nav-link:hover {
            color: #ede9e3;
            text-decoration: underline;
        }

        .current-selection {
            color: #ede9e3;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-decoration-color: #6b6560;
            transition: all 150ms ease;
        }

        .current-selection:hover {
            text-decoration-color: #9a958e;
        }

        /* Week Picker Dropdown */
        .week-picker {
            position: absolute;
            background: #1c1a19;
            border: 1px solid #3a3836;
            border-radius: 2px;
            padding: 16px;
            margin-top: 8px;
            z-index: 1000;
            display: none;
            min-width: 280px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .week-picker.visible {
            display: block;
        }

        .week-picker-header {
            font-size: 11px;
            color: #6b6560;
            margin-bottom: 12px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .week-item {
            font-size: 11px;
            color: #9a958e;
            padding: 6px;
            text-align: center;
            cursor: pointer;
            border: 1px solid #2a2826;
            border-radius: 2px;
            transition: all 150ms ease;
        }

        .week-item:hover {
            background: #2a2826;
            border-color: #3a3836;
            color: #ede9e3;
        }

        .week-item.selected {
            background: #3a3836;
            border-color: #4a4540;
            color: #ede9e3;
        }

        .season-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #2a2826;
        }

        .season-selector-label {
            font-size: 11px;
            color: #6b6560;
            letter-spacing: 0.05em;
        }

        .season-buttons {
            display: flex;
            gap: 8px;
        }

        .season-btn {
            font-size: 11px;
            color: #9a958e;
            padding: 4px 8px;
            cursor: pointer;
            border: 1px solid #2a2826;
            border-radius: 2px;
            transition: all 150ms ease;
        }

        .season-btn:hover {
            background: #2a2826;
            border-color: #3a3836;
            color: #ede9e3;
        }

        .season-btn.active {
            background: #3a3836;
            border-color: #4a4540;
            color: #ede9e3;
        }

        /* Statistics Line */
        .statistics-line {
            font-size: 13px;
            color: #6b6560;
            margin-bottom: 64px;
            line-height: 1.5;
        }

        .stat-number {
            color: #9a958e;
        }

        /* Spoiler Control - Toggle Slider */
        .spoiler-toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .toggle-label {
            font-size: 11px;
            color: #6b6560;
            letter-spacing: 0.05em;
        }

        .toggle-switch {
            position: relative;
            width: 32px;
            height: 16px;
            background: #2a2826;
            border-radius: 8px;
            cursor: pointer;
            transition: background 200ms ease;
            border: 1px solid #3a3836;
        }

        .toggle-switch.active {
            background: #4a4540;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 10px;
            height: 10px;
            background: #6b6560;
            border-radius: 50%;
            transition: all 200ms ease;
        }

        .toggle-switch.active .toggle-slider {
            left: 18px;
            background: #9a958e;
        }

        /* Game List - Card-free */
        .games-list {
            display: flex;
            flex-direction: column;
            gap: 48px;
        }

        .game-row {
            transition: color 150ms ease;
        }

        .matchup-wrapper {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 8px;
        }

        .matchup {
            font-size: 52px;
            font-weight: 400;
            color: #ede9e3;
            line-height: 1.1;
            letter-spacing: -0.01em;
            transition: color 150ms ease;
        }

        .game-row:hover .matchup {
            color: #ffffff;
        }

        .vs-separator {
            font-weight: 400;
        }

        /* Pie Chart Score Indicator */
        .score-pie {
            position: relative;
            width: 48px;
            height: 48px;
            flex-shrink: 0;
        }

        .score-pie svg {
            transform: rotate(-90deg);
        }

        .score-pie-bg {
            fill: none;
            stroke: #2a2826;
            stroke-width: 3;
        }

        .score-pie-fill {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            transition: stroke-dashoffset 400ms ease;
        }

        .score-pie-fill.must-watch {
            stroke: #8a9680;
        }

        .score-pie-fill.recommended {
            stroke: #a09a92;
        }

        .score-pie-fill.skip {
            stroke: #a08078;
        }

        .score-pie-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 13px;
            font-weight: 500;
            color: #ede9e3;
            line-height: 1;
        }

        .rating {
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.1em;
            text-transform: lowercase;
            margin-bottom: 8px;
        }

        .rating.must-watch {
            color: #8a9680;
        }

        .rating.recommended {
            color: #a09a92;
        }

        .rating.skip {
            color: #a08078;
        }

        .game-score {
            font-size: 11px;
            color: #6b6560;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 200ms ease, max-height 200ms ease;
        }

        .game-score.visible {
            opacity: 1;
            max-height: 20px;
        }

        /* Mobile-only score-rating line */
        .score-rating-line {
            display: none;
        }

        /* Loading State */
        .loading {
            padding: 60px 0;
        }

        .loading-text {
            font-size: 13px;
            color: #6b6560;
            animation: pulse-opacity 1.4s ease-in-out infinite;
        }

        @keyframes pulse-opacity {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }

        /* Empty State */
        .empty-state {
            padding: 60px 0;
        }

        .empty-message {
            font-size: 13px;
            color: #6b6560;
        }

        /* Footer */
        .footer {
            margin-top: 80px;
            padding-top: 80px;
        }

        .footer-text {
            font-size: 11px;
            color: #6b6560;
            line-height: 1.6;
            max-width: 500px;
        }

        .footer-link {
            color: #6b6560;
            text-decoration: underline;
            transition: color 150ms ease;
        }

        .footer-link:hover {
            color: #9a958e;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 24px 16px;
                overflow-x: hidden;
            }

            .content-wrapper,
            .about-content {
                max-width: 100%;
            }

            .masthead {
                font-size: 120px;
            }

            /* Show stacked layout elements */
            .score-rating-line {
                display: block;
                font-size: 13px;
                margin-bottom: 4px;
            }

            .score-rating-line .score-value {
                font-weight: 500;
            }

            .score-rating-line .score-separator {
                color: #6b6560;
            }

            /* Color rating text by tier */
            .score-rating-line.must-watch .rating-text {
                color: #8a9680;
            }

            .score-rating-line.recommended .rating-text {
                color: #a09a92;
            }

            .score-rating-line.skip .rating-text {
                color: #a08078;
            }

            /* Hide desktop-only elements */
            .score-pie {
                display: none;
            }

            .rating {
                display: none;
            }

            /* Matchup takes full width */
            .matchup {
                font-size: 32px;
                line-height: 1.15;
            }

            .matchup-wrapper {
                gap: 0;
                margin-bottom: 6px;
            }

            /* Tighten game row spacing */
            .games-list {
                gap: 32px;
            }

            /* Ensure no overflow */
            .game-row {
                max-width: 100%;
            }

            .main-nav {
                position: static;
                margin-top: 40px;
                margin-bottom: 40px;
            }
        }

        /* Hidden utility */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="main-nav">
            <a href="#" class="nav-link" id="aboutLink">about</a>
        </nav>

        <div class="main-content" id="mainContent">
            <div class="content-wrapper">
                <header>
                    <div class="masthead">GEI</div>
                    <div class="header-info">
                        <div class="site-title">Game Entertainment Index</div>
                        <div class="week-info" id="headerWeekInfo">Week 16 · December 28, 2025</div>
                    </div>
                </header>

                <div class="selection-interface">
                    <div class="sport-selector">
                        <span class="sport-option active" data-sport="NFL" id="nflOption">nfl</span>
                        <span class="separator">·</span>
                        <span class="sport-option" data-sport="CFB" id="cfbOption">cfb</span>
                    </div>
                    <div class="season-week-selector" style="position: relative;">
                        <a href="#" class="week-nav-link" id="prevWeek">← week <span id="prevWeekNum"></span></a>
                        <span class="separator">·</span>
                        <span class="current-selection" id="currentWeekDisplay">2024 · week 16</span>
                        <span class="separator">·</span>
                        <a href="#" class="week-nav-link" id="nextWeek">week <span id="nextWeekNum"></span> →</a>

                        <!-- Week Picker Dropdown -->
                        <div class="week-picker" id="weekPicker">
                            <div class="season-selector">
                                <span class="season-selector-label">season</span>
                                <div class="season-buttons" id="seasonButtons">
                                    <!-- Season buttons populated by JS -->
                                </div>
                            </div>
                            <div class="week-picker-header">select week</div>
                            <div class="week-grid" id="weekGrid">
                                <!-- Week buttons populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="resultsArea">
                    <!-- Results populated by JavaScript -->
                </div>

                <div class="footer">
                    <p class="footer-text">
                        Entertainment scores reflect game dynamics including score margin, lead changes, and overtime.
                    </p>
                </div>
            </div>
        </div>

        <div class="about-content hidden" id="aboutContent">
            <div class="content-wrapper">
                <header>
                    <div class="masthead">GEI</div>
                    <div class="header-info">
                        <div class="site-title">Game Entertainment Index</div>
                    </div>
                </header>

                <section class="about-section">
                    <h3>What is this?</h3>
                    <p>The Game Entertainment Index is a tool designed to help you find the most exciting and entertaining games to watch. Instead of watching every game, let our index guide you to the most thrilling matchups.</p>
                </section>

                <section class="about-section">
                    <h3>How does it work?</h3>
                    <p>Our scoring algorithm analyzes various factors including:</p>
                    <ul>
                        <li>Score Proximity — Close games are more exciting than blowouts</li>
                        <li>Lead Changes — Games with momentum swings keep you on the edge of your seat</li>
                        <li>Overtime — Extra time means extra drama</li>
                        <li>Final Score — Higher-scoring games often provide more action</li>
                    </ul>
                    <p>Each game receives a score from 0-10, with 10 being the most entertaining possible game.</p>
                </section>

                <section class="about-section">
                    <h3>How to use</h3>
                    <p>Select your sport (NFL or CFB) and navigate between weeks. Games are automatically ranked by entertainment value. Click any game row to reveal its score if you're browsing spoiler-free.</p>
                </section>
            </div>
        </div>
    </div>

    <script>
        // Get current week for a sport based on date
        function getCurrentWeek(sport) {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth(); // 0-indexed

            if (sport === 'NFL') {
                // NFL season runs September - February
                // Week 1 starts the Thursday after Labor Day (first Monday in September)
                // 2024 season: Started Sept 5, 2024
                // 2025 season: Started Sept 4, 2025

                let season;
                let seasonStart;

                // Try current year's season first
                season = year;
                seasonStart = new Date(year, 8, 1); // Sept 1

                // Find first Monday in September (Labor Day)
                while (seasonStart.getDay() !== 1) {
                    seasonStart.setDate(seasonStart.getDate() + 1);
                }

                // First Thursday after Labor Day (add 3 days)
                seasonStart.setDate(seasonStart.getDate() + 3);

                // If we're before this season's start, use previous year's season
                if (now < seasonStart) {
                    season = year - 1;
                    seasonStart = new Date(season, 8, 1); // Sept 1 of previous year
                    while (seasonStart.getDay() !== 1) {
                        seasonStart.setDate(seasonStart.getDate() + 1);
                    }
                    seasonStart.setDate(seasonStart.getDate() + 3);
                }

                // Calculate weeks since season start
                const daysSinceStart = Math.floor((now - seasonStart) / (24 * 60 * 60 * 1000));
                let week = Math.floor(daysSinceStart / 7) + 1;

                // Cap at week 18
                week = Math.min(18, Math.max(1, week));
                return { season: season, week: week };

            } else if (sport === 'CFB') {
                // CFB season runs late August - early January
                // Week 0/1 typically starts last week of August
                // 2024 season: Started Aug 24, 2024
                // 2025 season: Started Aug 30, 2025

                let season;
                let seasonStart;

                // Try current year's season first
                season = year;
                seasonStart = new Date(year, 7, 24); // Aug 24 (roughly last week of August)

                // If we're before this season's start, use previous year's season
                if (now < seasonStart) {
                    season = year - 1;
                    seasonStart = new Date(season, 7, 24); // Aug 24 of previous year
                }

                // Calculate weeks since season start
                const daysSinceStart = Math.floor((now - seasonStart) / (24 * 60 * 60 * 1000));
                let week = Math.floor(daysSinceStart / 7) + 1;

                // Cap at week 15 (regular season)
                week = Math.min(15, Math.max(1, week));
                return { season: season, week: week };
            }

            return { season: year, week: 1 };
        }

        // Legacy function for backwards compatibility
        function getCurrentNFLWeek() {
            return getCurrentWeek('NFL');
        }

        // State
        const currentNFLWeek = getCurrentNFLWeek();
        let selectedSport = 'NFL';
        let selectedSeason = currentNFLWeek.season;
        let selectedWeek = currentNFLWeek.week;
        let spoilerFree = localStorage.getItem('spoilerFree') !== 'false';
        let currentGames = null;
        let isLoading = false;

        // Initialize
        function init() {
            attachEventListeners();
            updateUI();
            loadGames();
        }

        // Update UI elements
        function updateUI() {
            // Update header week info
            const now = new Date();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('headerWeekInfo').textContent =
                `Week ${selectedWeek} · ${monthNames[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;

            // Update sport selector
            document.getElementById('nflOption').classList.toggle('active', selectedSport === 'NFL');
            document.getElementById('cfbOption').classList.toggle('active', selectedSport === 'CFB');

            // Update week display
            document.getElementById('currentWeekDisplay').textContent =
                `${selectedSeason} · week ${selectedWeek}`;

            // Update prev/next week numbers
            const maxWeeks = selectedSport === 'NFL' ? 18 : 15;
            const prevWeekNum = selectedWeek > 1 ? selectedWeek - 1 : null;
            const nextWeekNum = selectedWeek < maxWeeks ? selectedWeek + 1 : null;

            const prevWeekLink = document.getElementById('prevWeek');
            const nextWeekLink = document.getElementById('nextWeek');

            if (prevWeekNum) {
                document.getElementById('prevWeekNum').textContent = prevWeekNum;
                prevWeekLink.style.display = 'inline';
            } else {
                prevWeekLink.style.display = 'none';
            }

            if (nextWeekNum) {
                document.getElementById('nextWeekNum').textContent = nextWeekNum;
                nextWeekLink.style.display = 'inline';
            } else {
                nextWeekLink.style.display = 'none';
            }
        }

        // Attach event listeners
        function attachEventListeners() {
            // Sport selector
            document.getElementById('nflOption').addEventListener('click', () => {
                if (selectedSport !== 'NFL') {
                    selectedSport = 'NFL';
                    const currentWeek = getCurrentWeek('NFL');
                    selectedSeason = currentWeek.season;
                    selectedWeek = currentWeek.week;
                    updateUI();
                    loadGames();
                }
            });

            document.getElementById('cfbOption').addEventListener('click', () => {
                if (selectedSport !== 'CFB') {
                    selectedSport = 'CFB';
                    const currentWeek = getCurrentWeek('CFB');
                    selectedSeason = currentWeek.season;
                    selectedWeek = currentWeek.week;
                    updateUI();
                    loadGames();
                }
            });

            // Week navigation
            document.getElementById('prevWeek').addEventListener('click', (e) => {
                e.preventDefault();
                if (selectedWeek > 1) {
                    selectedWeek--;
                    updateUI();
                    loadGames();
                }
            });

            document.getElementById('nextWeek').addEventListener('click', (e) => {
                e.preventDefault();
                const maxWeeks = selectedSport === 'NFL' ? 18 : 15;
                if (selectedWeek < maxWeeks) {
                    selectedWeek++;
                    updateUI();
                    loadGames();
                }
            });

            // About link
            document.getElementById('aboutLink').addEventListener('click', (e) => {
                e.preventDefault();
                const mainContent = document.getElementById('mainContent');
                const aboutContent = document.getElementById('aboutContent');

                if (aboutContent.classList.contains('hidden')) {
                    mainContent.classList.add('hidden');
                    aboutContent.classList.remove('hidden');
                    e.target.textContent = 'home';
                } else {
                    aboutContent.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    e.target.textContent = 'about';
                }
            });

            // Week picker toggle
            document.getElementById('currentWeekDisplay').addEventListener('click', (e) => {
                e.stopPropagation();
                const picker = document.getElementById('weekPicker');
                const isVisible = picker.classList.contains('visible');

                if (!isVisible) {
                    populateWeekPicker();
                    picker.classList.add('visible');
                } else {
                    picker.classList.remove('visible');
                }
            });

            // Close week picker when clicking outside
            document.addEventListener('click', (e) => {
                const picker = document.getElementById('weekPicker');
                const currentWeekDisplay = document.getElementById('currentWeekDisplay');

                if (!picker.contains(e.target) && e.target !== currentWeekDisplay) {
                    picker.classList.remove('visible');
                }
            });
        }

        // Populate week picker dropdown
        function populateWeekPicker() {
            const currentYear = new Date().getFullYear();
            const maxWeeks = selectedSport === 'NFL' ? 18 : 15;

            // Determine current season for the selected sport
            const currentSeasonInfo = getCurrentWeek(selectedSport);
            const currentSeasonYear = currentSeasonInfo.season;

            // Populate season buttons
            // Show current season and previous season only (ESPN historical data is limited)
            const seasonButtons = document.getElementById('seasonButtons');
            seasonButtons.innerHTML = '';

            // Only show current season and one year back
            for (let year = currentSeasonYear; year >= currentSeasonYear - 1; year--) {
                const btn = document.createElement('div');
                btn.className = 'season-btn';
                if (year === selectedSeason) {
                    btn.classList.add('active');
                }
                btn.textContent = year;
                btn.addEventListener('click', () => {
                    selectedSeason = year;
                    selectedWeek = 1; // Reset to week 1 when changing season
                    updateUI();
                    loadGames();
                    document.getElementById('weekPicker').classList.remove('visible');
                });
                seasonButtons.appendChild(btn);
            }

            // Populate week grid
            const weekGrid = document.getElementById('weekGrid');
            weekGrid.innerHTML = '';

            for (let week = 1; week <= maxWeeks; week++) {
                const weekItem = document.createElement('div');
                weekItem.className = 'week-item';
                if (week === selectedWeek) {
                    weekItem.classList.add('selected');
                }
                weekItem.textContent = week;
                weekItem.addEventListener('click', () => {
                    selectedWeek = week;
                    updateUI();
                    loadGames();
                    document.getElementById('weekPicker').classList.remove('visible');
                });
                weekGrid.appendChild(weekItem);
            }
        }

        // Load games
        async function loadGames() {
            if (isLoading) return;
            isLoading = true;
            showLoading();

            try {
                const response = await fetch('/api/games', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sport: selectedSport,
                        season: selectedSeason,
                        week: selectedWeek,
                        seasonType: '2'
                    })
                });

                const data = await response.json();

                if (data.success && data.games && data.games.length > 0) {
                    currentGames = data.games;
                    displayResults();
                } else {
                    showEmpty();
                }
            } catch (error) {
                console.error('Error:', error);
                showEmpty('Could not load games. Please try again.');
            } finally {
                isLoading = false;
            }
        }

        // Show loading state
        function showLoading() {
            const resultsArea = document.getElementById('resultsArea');
            resultsArea.innerHTML = `
                <div class="loading">
                    <div class="loading-text">loading week ${selectedWeek}...</div>
                </div>
            `;
        }

        // Show empty state
        function showEmpty(message = `No games found for Week ${selectedWeek}, ${selectedSeason}.`) {
            const resultsArea = document.getElementById('resultsArea');
            resultsArea.innerHTML = `
                <div class="empty-state">
                    <div class="empty-message">${message}</div>
                </div>
            `;
        }

        // Display results
        function displayResults() {
            if (!currentGames) return;

            // Sort by excitement score
            const sortedGames = [...currentGames].sort((a, b) => (b.excitement || 0) - (a.excitement || 0));

            // Calculate statistics
            const stats = {
                mustWatch: sortedGames.filter(g => (g.excitement || 0) >= 8).length,
                recommended: sortedGames.filter(g => (g.excitement || 0) >= 6 && (g.excitement || 0) < 8).length,
                skip: sortedGames.filter(g => (g.excitement || 0) < 6).length
            };

            // Build HTML
            let html = '';

            // Statistics line
            html += `<div class="statistics-line">
                <span class="stat-number">${stats.mustWatch}</span> must watch ·
                <span class="stat-number">${stats.recommended}</span> recommended ·
                <span class="stat-number">${stats.skip}</span> skip
            </div>`;

            // Toggle slider for scores
            html += `
                <div class="spoiler-toggle-wrapper">
                    <span class="toggle-label">show scores</span>
                    <div class="toggle-switch ${!spoilerFree ? 'active' : ''}" id="scoreToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            `;

            // Games list
            html += '<div class="games-list">';
            sortedGames.forEach((game, index) => {
                html += createGameRow(game, index);
            });
            html += '</div>';

            document.getElementById('resultsArea').innerHTML = html;

            // Attach event listeners
            attachScoreToggleListener();
        }

        // Create game row HTML
        function createGameRow(game, index) {
            const score = game.excitement || 0;
            let ratingClass, ratingText;

            if (score >= 8) {
                ratingClass = 'must-watch';
                ratingText = 'must watch';
            } else if (score >= 6) {
                ratingClass = 'recommended';
                ratingText = 'recommended';
            } else {
                ratingClass = 'skip';
                ratingText = 'skip';
            }

            const shouldShowGameScore = !spoilerFree;

            // Format scores
            const displayScore = score % 1 === 0 ? score : score.toFixed(1);
            const gameScoreText = `${game.awayScore || 0}-${game.homeScore || 0}${game.overtime ? ' OT' : ''}`;

            // Calculate pie chart values
            const radius = 21;
            const circumference = 2 * Math.PI * radius;
            const progress = (score / 10) * circumference;
            const remaining = circumference - progress;

            return `
                <div class="game-row" data-game-index="${index}">
                    <div class="score-rating-line ${ratingClass}">
                        <span class="score-value">${displayScore}</span>
                        <span class="score-separator"> · </span>
                        <span class="rating-text">${ratingText}</span>
                    </div>
                    <div class="matchup-wrapper">
                        <div class="score-pie">
                            <svg width="48" height="48" viewBox="0 0 48 48">
                                <circle class="score-pie-bg" cx="24" cy="24" r="${radius}"/>
                                <circle class="score-pie-fill ${ratingClass}"
                                        cx="24" cy="24" r="${radius}"
                                        stroke-dasharray="${progress} ${remaining}"/>
                            </svg>
                            <div class="score-pie-value">${displayScore}</div>
                        </div>
                        <div class="matchup">
                            ${game.awayTeam} <span class="vs-separator">v</span> ${game.homeTeam}
                        </div>
                    </div>
                    <div class="rating ${ratingClass}">${ratingText}</div>
                    <div class="game-score ${shouldShowGameScore ? 'visible' : ''}">${gameScoreText}</div>
                </div>
            `;
        }

        // Attach score toggle listener
        function attachScoreToggleListener() {
            const toggle = document.getElementById('scoreToggle');
            if (toggle) {
                toggle.addEventListener('click', () => {
                    spoilerFree = !spoilerFree;
                    localStorage.setItem('spoilerFree', spoilerFree);
                    displayResults();
                });
            }
        }

        // Start the app
        init();
    </script>
</body>
</html>
