<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Excitement Tracker - AI Powered</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const GameExcitementTracker = () => {
      // original state kept where useful; date picker removed
      const [minRating, setMinRating] = useState(0);
      const [showScores, setShowScores] = useState({});
      const [selectedSport, setSelectedSport] = useState('NFL');
      const [games, setGames] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [analysisSource, setAnalysisSource] = useState('');

      // Fetch game data via your serverless function (last 7 days, cached)
      const fetchGameData = async (sport) => {
        setLoading(true);
        setError(null);
        setAnalysisSource('');

        try {
          const response = await fetch('/api/games', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sport }) // no date
          });

          if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
          }

          const data = await response.json();

          if (!data.success) {
            throw new Error(data.details || data.error || 'API call failed');
          }

          if (!data.games || data.games.length === 0) {
            setError(`No ${sport} games found in the last 7 days`);
            setGames([]);
            setAnalysisSource('No games found');
            return;
          }

          setGames(data.games);

          // Show source and the range from the backend if present
          const src = data.metadata?.source || 'AI Analysis';
          const range = data.metadata?.range ? ` â€¢ ${data.metadata.range}` : '';
          const cached = data.metadata?.cached ? ' â€¢ Cached' : '';
          setAnalysisSource(`${src}${range}${cached}`);
        } catch (err) {
          setError(`Failed to analyze ${sport}: ${err.message}`);
          setGames([]);
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        setGames([]);
        setShowScores({});
        setError(null);
        fetchGameData(selectedSport);
      }, [selectedSport]);

      const getRatingColor = (rating) => {
        if (rating >= 8.5) return '#ff0000';
        if (rating >= 7) return '#ff8800';
        if (rating >= 6) return '#ffcc00';
        if (rating >= 5) return '#0088ff';
        return '#888888';
      };

      const getRatingLabel = (rating) => {
        if (rating >= 8.5) return 'MUST WATCH';
        if (rating >= 7) return 'GREAT';
        if (rating >= 6) return 'GOOD';
        if (rating >= 5) return 'OK';
        return 'SKIP';
      };

      const filteredGames = games.filter(game => (game.excitement ?? 0) >= minRating);

      const toggleScore = (gameId) => {
        setShowScores(prev => ({ ...prev, [gameId]: !prev[gameId] }));
      };

      // kept for possible future use elsewhere
      const formatDate = (dateStr) => {
        const date = new Date(dateStr + 'T00:00:00');
        return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
      };

      return React.createElement('div', {
        style: {
          fontFamily: 'Monaco, "Courier New", monospace',
          backgroundColor: '#f0f0f0',
          minHeight: '100vh',
          padding: '20px'
        }
      },
        React.createElement('div', { style: { maxWidth: '800px', margin: '0 auto' } },
          // Header
          React.createElement('div', { style: { textAlign: 'center', marginBottom: '30px' } },
            React.createElement('h1', {
              style: {
                fontSize: '24px',
                fontWeight: 'bold',
                margin: '0 0 10px 0',
                color: '#000'
              }
            }, 'GAME EXCITEMENT TRACKER'),
            React.createElement('p', {
              style: {
                fontSize: '14px',
                color: '#666',
                margin: '0 0 5px 0'
              }
            }, 'AI-powered win probability variance analysis'),
            analysisSource && React.createElement('div', {
              style: { fontSize: '10px', color: '#888', marginTop: '5px' }
            }, `ðŸ¤– ${analysisSource}`)
          ),

          // Controls
          React.createElement('div', {
            style: {
              backgroundColor: '#fff',
              border: '2px solid #000',
              padding: '15px',
              marginBottom: '20px'
            }
          },
            React.createElement('div', {
              style: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                gap: '15px',
                alignItems: 'end'
              }
            },
              // RANGE (replaces date input, same visual weight)
              React.createElement('div', null,
                React.createElement('label', {
                  style: {
                    display: 'block',
                    fontSize: '12px',
                    fontWeight: 'bold',
                    marginBottom: '5px'
                  }
                }, 'RANGE:'),
                React.createElement('div', {
                  style: {
                    width: '100%',
                    padding: '8px',
                    border: '1px solid #000',
                    fontSize: '12px',
                    backgroundColor: '#f7f7f7',
                    fontFamily: 'inherit'
                  }
                }, 'Last 7 days')
              ),

              // SPORT
              React.createElement('div', null,
                React.createElement('label', {
                  style: {
                    display: 'block',
                    fontSize: '12px',
                    fontWeight: 'bold',
                    marginBottom: '5px'
                  }
                }, 'SPORT:'),
                React.createElement('select', {
                  value: selectedSport,
                  onChange: (e) => setSelectedSport(e.target.value),
                  style: {
                    width: '100%',
                    padding: '8px',
                    border: '1px solid #000',
                    fontSize: '12px',
                    fontFamily: 'inherit',
                    backgroundColor: '#fff'
                  }
                },
                  React.createElement('option', { value: 'NFL' }, 'NFL'),
                  React.createElement('option', { value: 'NBA' }, 'NBA'),
                  React.createElement('option', { value: 'MLB' }, 'MLB')
                )
              ),

              // MIN RATING
              React.createElement('div', null,
                React.createElement('label', {
                  style: {
                    display: 'block',
                    fontSize: '12px',
                    fontWeight: 'bold',
                    marginBottom: '5px'
                  }
                }, `MIN RATING: ${minRating}`),
                React.createElement('input', {
                  type: 'range',
                  min: '0',
                  max: '10',
                  step: '0.5',
                  value: minRating,
                  onChange: (e) => setMinRating(parseFloat(e.target.value)),
                  style: { width: '100%' }
                })
              ),

              // REFRESH
              React.createElement('div', null,
                React.createElement('button', {
                  onClick: () => fetchGameData(selectedSport),
                  disabled: loading,
                  style: {
                    width: '100%',
                    padding: '8px',
                    border: '2px solid '#000',
                    backgroundColor: loading ? '#ccc' : '#fff',
                    fontSize: '12px',
                    fontWeight: 'bold',
                    cursor: loading ? 'not-allowed' : 'pointer',
                    fontFamily: 'inherit'
                  }
                }, loading ? 'ANALYZING...' : 'REFRESH')
              )
            ),

            error && React.createElement('div', {
              style: {
                marginTop: '15px',
                padding: '10px',
                backgroundColor: '#ffffcc',
                border: '1px solid #000',
                fontSize: '12px'
              }
            }, error)
          ),

          // Games Header
          React.createElement('div', {
            style: {
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '15px'
            }
          },
            React.createElement('h2', {
              style: { fontSize: '16px', fontWeight: 'bold', margin: '0' }
            }, `LAST 7 DAYS - ${selectedSport}`),
            React.createElement('div', { style: { fontSize: '12px', color: '#666' } },
              `${filteredGames.length} GAMES`
            )
          ),

          // Games List
          React.createElement('div', { style: { marginBottom: '30px' } },
            loading
              ? React.createElement('div', {
                  style: { backgroundColor: '#fff', border: '2px solid #000', padding: '40px', textAlign: 'center' }
                },
                  React.createElement('div', { style: { fontSize: '14px', fontWeight: 'bold', marginBottom: '10px' } },
                    'ANALYZING WIN PROBABILITY VARIANCE...'
                  ),
                  React.createElement('div', { style: { fontSize: '11px', color: '#666' } },
                    'AI is reading ESPN charts and summarizing momentum swings'
                  )
                )
              : filteredGames.length === 0
                ? React.createElement('div', {
                    style: { backgroundColor: '#fff', border: '2px solid #000', padding: '40px', textAlign: 'center' }
                  },
                    React.createElement('div', { style: { fontSize: '14px', color: '#666' } }, 'NO GAMES FOUND')
                  )
                : filteredGames
                    .sort((a, b) => (b.excitement ?? 0) - (a.excitement ?? 0))
                    .map((game) =>
                      React.createElement('div', {
                        key: game.id,
                        style: { backgroundColor: '#fff', border: '2px solid #000', marginBottom: '10px', cursor: 'pointer' },
                        onClick: () => toggleScore(game.id)
                      },
                        React.createElement('div', { style: { padding: '15px' } },
                          React.createElement('div', {
                            style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center' }
                          },
                            React.createElement('div', { style: { fontSize: '14px', fontWeight: 'bold' } },
                              `${game.awayTeam} @ ${game.homeTeam}`,
                              game.date ? ` â€” ${formatDate(game.date)}` : ''
                            ),
                            React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '15px' } },
                              React.createElement('div', { style: { textAlign: 'right' } },
                                React.createElement('div', {
                                  style: {
                                    backgroundColor: getRatingColor(game.excitement),
                                    color: '#fff',
                                    padding: '4px 8px',
                                    fontSize: '12px',
                                    fontWeight: 'bold',
                                    border: '1px solid #000'
                                  }
                                }, `${game.excitement}/10`),
                                React.createElement('div', {
                                  style: { fontSize: '10px', color: '#666', marginTop: '2px' }
                                }, getRatingLabel(game.excitement))
                              ),
                              React.createElement('div', { style: { fontSize: '12px', color: '#666' } },
                                showScores[game.id] ? 'â–¼ HIDE' : 'â–¶ SHOW'
                              )
                            )
                          ),

                          showScores[game.id] && React.createElement('div', {
                            style: { marginTop: '15px', paddingTop: '15px', borderTop: '1px solid #ccc' }
                          },
                            React.createElement('div', {
                              style: { fontSize: '18px', fontWeight: 'bold', marginBottom: '10px' }
                            }, `FINAL: ${game.awayTeam} ${game.awayScore} - ${game.homeScore} ${game.homeTeam}${game.overtime ? ' (OT)' : ''}`),

                            game.description && React.createElement('div', {
                              style: { fontSize: '12px', color: '#333', marginBottom: '8px', fontWeight: 'bold' }
                            }, `ðŸ“Š ${game.description}`),

                            game.varianceAnalysis && React.createElement('div', {
                              style: { fontSize: '11px', color: '#666', marginBottom: '8px' }
                            }, `ðŸ”„ ${game.varianceAnalysis}`),

                            game.keyMoments && game.keyMoments.length > 0 && React.createElement('div', {
                              style: { fontSize: '10px', color: '#888' }
                            },
                              React.createElement('div', { style: { fontWeight: 'bold', marginBottom: '4px' } }, 'KEY MOMENTS:'),
                              game.keyMoments.map((moment, index) =>
                                React.createElement('div', { key: index, style: { marginLeft: '8px' } }, `â€¢ ${moment}`)
                              )
                            )
                          )
                        )
                      )
                    )
          ),

          // Rating Legend
          React.createElement('div', {
            style: { backgroundColor: '#fff', border: '2px solid #000', padding: '15px' }
          },
            React.createElement('h3', { style: { fontSize: '14px', fontWeight: 'bold', margin: '0 0 10px 0' } },
              'AI EXCITEMENT ANALYSIS:'
            ),
            React.createElement('div', {
              style: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',
                gap: '10px',
                fontSize: '11px'
              }
            },
              React.createElement('div', { style: { textAlign: 'center' } },
                React.createElement('div', {
                  style: { backgroundColor: '#ff0000', color: '#fff', padding: '4px', fontWeight: 'bold', marginBottom: '5px' }
                }, '8.5-10'),
                React.createElement('div', null, 'MUST WATCH'),
                React.createElement('div', { style: { fontSize: '9px', color: '#888', marginTop: '2px' } }, 'High variance')
              ),
              React.createElement('div', { style: { textAlign: 'center' } },
                React.createElement('div', {
                  style: { backgroundColor: '#ff8800', color: '#fff', padding: '4px', fontWeight: 'bold', marginBottom: '5px' }
                }, '7.0-8.4'),
                React.createElement('div', null, 'GREAT'),
                React.createElement('div', { style: { fontSize: '9px', color: '#888', marginTop: '2px' } }, 'Many swings')
              ),
              React.createElement('div', { style: { textAlign: 'center' } },
                React.createElement('div', {
                  style: { backgroundColor: '#ffcc00', color: '#000', padding: '4px', fontWeight: 'bold', marginBottom: '5px' }
                }, '6.0-6.9'),
                React.createElement('div', null, 'GOOD'),
                React.createElement('div', { style: { fontSize: '9px', color: '#888', marginTop: '2px' } }, 'Some drama')
              ),
              React.createElement('div', { style: { textAlign: 'center' } },
                React.createElement('div', {
                  style: { backgroundColor: '#0088ff', color: '#fff', padding: '4px', fontWeight: 'bold', marginBottom: '5px' }
                }, '5.0-5.9'),
                React.createElement('div', null, 'OK'),
                React.createElement('div', { style: { fontSize: '9px', color: '#888', marginTop: '2px' } }, 'Steady game')
              ),
              React.createElement('div', { style: { textAlign: 'center' } },
                React.createElement('div', {
                  style: { backgroundColor: '#888888', color: '#fff', padding: '4px', fontWeight: 'bold', marginBottom: '5px' }
                }, '0-4.9'),
                React.createElement('div', null, 'SKIP'),
                React.createElement('div', { style: { fontSize: '9px', color: '#888', marginTop: '2px' } }, 'Low variance')
              )
            ),
            React.createElement('div', {
              style: { marginTop: '15px', padding: '10px', backgroundColor: '#f5f5f5', fontSize: '10px', color: '#666' }
            }, 'ðŸ¤– AI analyzes ESPN win probability charts to identify games with high variance and dramatic momentum swings')
          )
        )
      );
    };

    ReactDOM.render(React.createElement(GameExcitementTracker), document.getElementById('root'));
  </script>
</body>
</html>
